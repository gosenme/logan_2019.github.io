<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="apscheduler                                                                                                                         文章目录安装基本概念介绍调度器的工作流程实例1 -间隔性任务实例2 - cron 任务配置调度器方法一方法二方">
<meta property="og:type" content="article">
<meta property="og:title" content="apscheduler">
<meta property="og:url" content="http://logan_2019.github.io/csdn/python_apscheduler/2019/10/index.html">
<meta property="og:site_name" content="OYJX">
<meta property="og:description" content="apscheduler                                                                                                                         文章目录安装基本概念介绍调度器的工作流程实例1 -间隔性任务实例2 - cron 任务配置调度器方法一方法二方">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/12989993-1a788aae377adacc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/12989993-8604178208b8683d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/12989993-a87021dbc9fd9f21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-10-13T04:12:02.209Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="apscheduler">
<meta name="twitter:description" content="apscheduler                                                                                                                         文章目录安装基本概念介绍调度器的工作流程实例1 -间隔性任务实例2 - cron 任务配置调度器方法一方法二方">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/12989993-1a788aae377adacc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>apscheduler</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/gin/gin项目开发/2019/10/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/Python无师自通/6_strings/2019/10/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&text=apscheduler"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&is_video=false&description=apscheduler"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=apscheduler&body=Check out this article: http://logan_2019.github.io/csdn/python_apscheduler/2019/10/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&name=apscheduler&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">文章目录</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">基本概念介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">调度器的工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">实例1 -间隔性任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">实例2 - cron 任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">配置调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">方法二</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.3.</span> <span class="toc-text">方法三：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">启动调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">方法一：使用默认的作业存储器：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">方法二：使用数据库作为存储器：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">调度器事件监听</span></a>
    </li></div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        apscheduler
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">OYJX</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-10-13T04:12:02.209Z" itemprop="datePublished">2019-10-13</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    
<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <title>apscheduler</title>
</head>
<body>
<article class="baidu_pl">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
              <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-cd6c485e8b.css">
                              <div id="content_views" class="markdown_views prism-atom-one-dark">
            <!-- flowchart 箭头图标 勿删 -->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
              <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"/>
            </svg>
            <p></p><div class="toc"><h3><a name="t0"></a>文章目录</h3><ul><ul><li><a href="#_6" rel="nofollow" target="_self">安装</a></li><li><a href="#_12" rel="nofollow" target="_self">基本概念介绍</a></li><li><a href="#_22" rel="nofollow" target="_self">调度器的工作流程</a></li><ul><ul><li><a href="#1__26" rel="nofollow" target="_self">实例1 -间隔性任务</a></li><li><a href="#2__cron__70" rel="nofollow" target="_self">实例2 - cron 任务</a></li></ul></ul><li><a href="#_106" rel="nofollow" target="_self">配置调度器</a></li><ul><ul><li><a href="#_142" rel="nofollow" target="_self">方法一</a></li><li><a href="#_166" rel="nofollow" target="_self">方法二</a></li><li><a href="#_191" rel="nofollow" target="_self">方法三：</a></li></ul></ul><li><a href="#_217" rel="nofollow" target="_self">启动调度器</a></li><ul><ul><li><a href="#_225" rel="nofollow" target="_self">方法一：使用默认的作业存储器：</a></li><li><a href="#_272" rel="nofollow" target="_self">方法二：使用数据库作为存储器：</a></li></ul></ul><li><a href="#_357" rel="nofollow" target="_self">调度器事件监听</a></li></ul></ul></div><p></p>
<p>说到定时任务，你会想起 linux 自带的 crontab ，windows 自带的任务计划，都可以实现守时任务。没错，操作系统基本都会提供定时任务的实现，但是如果你想要更加精细化的控制，或者说任务程序需要跨平台运行，最好还是自己实现定时任务框架，Python 的 apscheduler 提供了非常丰富而且方便易用的定时任务接口。本文介绍如何使用 apscheduler 实现你的定时任务。</p>
<p>apscheduler 使用起来十分方便。提供了基于日期、固定时间间隔以及crontab 类型的任务，我们可以在主程序的运行过程中快速增加新作业或删除旧作业，如果把作业存储在数据库中，那么作业的状态会被保存，当调度器重启时，不必重新添加作业，作业会恢复原状态继续执行。apscheduler 可以当作一个跨平台的调度工具来使用，可以做为 linux 系统crontab 工具或 windows 计划任务程序的替换。注意，apscheduler 不是一个守护进程或服务，它自身不带有任何命令行工具。它主要是要在现有的应用程序中运行，也就是说，apscheduler 为我们提供了构建专用调度器或调度服务的基础模块。</p>
<h2><a name="t1"></a><a id="_6" target="_blank"></a>安装</h2>
<p>安装非常简单，会用 pip 的人都知道</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">pin install apscheduler
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<h2><a name="t2"></a><a id="_12" target="_blank"></a>基本概念介绍</h2>
<p><strong>触发器（triggers）</strong>：触发器包含调度逻辑，描述一个任务何时被触发，按日期或按时间间隔或按 cronjob 表达式三种方式触发。每个作业都有它自己的触发器，除了初始配置之外，触发器是完全无状态的。</p>
<p><strong>作业存储器（job stores）</strong>：作业存储器指定了作业被存放的位置，默认情况下作业保存在内存，也可将作业保存在各种数据库中，当作业被存放在数据库中时，它会被序列化，当被重新加载时会反序列化。作业存储器充当保存、加载、更新和查找作业的中间商。在调度器之间不能共享作业存储。</p>
<p><strong>执行器（executors）</strong>：执行器是将指定的作业（调用函数）提交到线程池或进程池中运行，当任务完成时，执行器通知调度器触发相应的事件。</p>
<p><strong>调度器（schedulers）</strong>：任务调度器，属于控制角色，通过它配置作业存储器、执行器和触发器，添加、修改和删除任务。调度器协调触发器、作业存储器、执行器的运行，通常只有一个调度程序运行在应用程序中，开发人员通常不需要直接处理作业存储器、执行器或触发器，配置作业存储器和执行器是通过调度器来完成的。</p>
<h2><a name="t3"></a><a id="_22" target="_blank"></a>调度器的工作流程</h2>
<p><img src="https://upload-images.jianshu.io/upload_images/12989993-1a788aae377adacc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4><a id="1__26" target="_blank"></a>实例1 -间隔性任务</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># Time: 2018/10/13 19:01:30</span>
<span class="token comment"># File Name: ex_interval.py</span>

<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> os
<span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler

<span class="token keyword">def</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tick! The time is: %s'</span> <span class="token operator">%</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
    scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token string">'interval'</span><span class="token punctuation">,</span> seconds<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Press Ctrl+{0} to exit'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'Break'</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'nt'</span> <span class="token keyword">else</span> <span class="token string">'C    '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyboardInterrupt<span class="token punctuation">,</span> SystemExit<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code></pre>
<p>说明：<br>
第 1 行代码声明文件内容以 utf-8 编码，告诉Python 解释器以 utf-8 编码解析源代码文件。</p>
<p>导入 datetime 模块，用于打印当前时间。导入 os 模块，用于判断操作系统类型。</p>
<p>导入调度器模块 BlockingScheduler，这是最简单的调度器，调用 start 方阻塞当前进程，如果你的程序只用于调度，除了调度进程外没有其他后台进程，那么请用 BlockingScheduler 非常有用，此时调度进程相当于守护进程。</p>
<p>定义一个函数 tick 代表我们要调度的作业程序。</p>
<p>实例化一个 BlockingScheduler 类，不带参数表明使用默认的作业存储器-内存，默认的执行器是线程池执行器，最大并发线程数默认为 10 个（另一个是进程池执行器）。</p>
<p>第 11 行添加一个作业 tick，触发器为 interval，每隔 3 秒执行一次，另外的触发器为 date，cron。date 按特定时间点触发，cron 则按固定的时间间隔触发。<br>
加入捕捉用户中断执行和解释器退出异常，pass 关键字，表示什么也不做。</p>
<p>执行结果如下所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12989993-8604178208b8683d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>可以看出，每 3 秒打印出了当前时间。</p>
<h4><a id="2__cron__70" target="_blank"></a>实例2 - cron 任务</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># Time: 2018/10/13 19:21:09</span>
<span class="token comment"># File Name: ex_cron.py</span>


<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> os
<span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler

<span class="token keyword">def</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tick! The time is: %s'</span> <span class="token operator">%</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
    scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token string">'cron'</span><span class="token punctuation">,</span> hour<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span>minute<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Press Ctrl+{0} to exit'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'Break'</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'nt'</span> <span class="token keyword">else</span> <span class="token string">'C    '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyboardInterrupt<span class="token punctuation">,</span> SystemExit<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code></pre>
<p>定时 cron 任务也非常简单，直接给触发器 trigger 传入 ‘cron’ 即可。hour =19 ,minute =23 这里表示每天的19：23 分执行任务。这里可以填写数字，也可以填写字符串</p>
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.signin(event)">hour =19 , minute =23
hour ='19', minute ='23'
minute = '*/3' 表示每 5 分钟执行一次
hour ='19-21', minute= '23' 表示 19:23、 20:23、 21:23 各执行一次任务
<div class="hljs-button signin" data-title="登录后复制"></div></code></pre>
<p>python 就是这么灵活、易用、可读。例 2  执行结果如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12989993-a87021dbc9fd9f21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2><a name="t4"></a><a id="_106" target="_blank"></a>配置调度器</h2>
<p>调度器的主循环其实就是反复检查是不是有到时需要执行的任务，分以下几步进行：</p>
<ol>
<li>询问自己的每一个作业存储器，有没有到期需要执行的任务，如果有，计算这些作业中每个作业需要运行的时间点，如果时间点有多个，做 coalesce 检查。</li>
<li>提交给执行器按时间点运行。</li>
</ol>
<p>在配置调度器前，我们首先要选取适合我们应用环境场景的调度器，存储器和执行器。下面是各调度器的适用场景：</p>
<ul>
<li>BlockingScheduler：适用于调度程序是进程中唯一运行的进程，调用start函数会阻塞当前线程，不能立即返回。</li>
<li>BackgroundScheduler：适用于调度程序在应用程序的后台运行，调用start后主线程不会阻塞。</li>
<li>AsyncIOScheduler：适用于使用了asyncio模块的应用程序。</li>
<li>GeventScheduler：适用于使用gevent模块的应用程序。</li>
<li>TwistedScheduler：适用于构建Twisted的应用程序。</li>
<li>QtScheduler：适用于构建Qt的应用程序。<br>
上述调度器可以满足我们绝大多数的应用环境，本文以两种调度器为例说明如何进行调度器配置。</li>
</ul>
<p>作业存储器的选择有两种：一是内存，也是默认的配置；二是数据库。具体选哪一种看我们的应用程序在崩溃时是否重启整个应用程序，如果重启整个应用程序，那么作业会被重新添加到调度器中，此时简单的选取内存作为作业存储器即简单又高效。但是，当调度器重启或应用程序崩溃时您需要您的作业从中断时恢复正常运行，那么通常我们选择将作业存储在数据库中，使用哪种数据库通常取决于为在您的编程环境中使用了什么数据库。我们可以自由选择，PostgreSQL 是推荐的选择，因为它具有强大的数据完整性保护。</p>
<p>同样的，执行器的选择也取决于应用场景。通常默认的 ThreadPoolExecutor 已经足够好。如果作业负载涉及CPU 密集型操作，那么应该考虑使用 ProcessPoolExecutor，甚至可以同时使用这两种执行器，将ProcessPoolExecutor 行器添加为二级执行器。</p>
<p>apscheduler 提供了许多不同的方法来配置调度器。可以使用字典，也可以使用关键字参数传递。首先实例化调度程序，添加作业，然后配置调度器，获得最大的灵活性。</p>
<p>如果调度程序在应用程序的<strong>后台运行</strong>，选择 BackgroundScheduler，并使用默认的 jobstore 和默认的executor，则以下配置即可：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)"><span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>background <span class="token keyword">import</span> BackgroundScheduler
scheduler <span class="token operator">=</span> BackgroundScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code></pre>
<p>假如我们想<strong>配置更多信息</strong>：设置两个执行器、两个作业存储器、调整新作业的默认值，并设置不同的时区。下述三个方法是完全等同的。<br>
配置需求</p>
<ul>
<li>配置名为“mongo”的MongoDBJobStore作业存储器</li>
<li>配置名为“default”的SQLAlchemyJobStore(使用SQLite)</li>
<li>配置名为“default”的ThreadPoolExecutor，最大线程数为20</li>
<li>配置名为“processpool”的ProcessPoolExecutor，最大进程数为5</li>
<li>UTC作为调度器的时区</li>
<li>coalesce默认情况下关闭</li>
<li>作业的默认最大运行实例限制为3</li>
</ul>
<h4><a id="_142" target="_blank"></a>方法一</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token keyword">from</span> pytz <span class="token keyword">import</span> utc
  <span class="token number">2</span>
  <span class="token number">3</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>background <span class="token keyword">import</span> BackgroundScheduler
  <span class="token number">4</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>mongodb <span class="token keyword">import</span> MongoDBJobStore
  <span class="token number">5</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>sqlalchemy <span class="token keyword">import</span> SQLAlchemyJobStore
  <span class="token number">6</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>executors<span class="token punctuation">.</span>pool <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> ProcessPoolExec    utor
  <span class="token number">7</span>
  <span class="token number">8</span>
  <span class="token number">9</span>   jobstores <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">10</span>       <span class="token string">'mongo'</span><span class="token punctuation">:</span> MongoDBJobStore<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token number">11</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> SQLAlchemyJobStore<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'sqlite:///jobs.sqlite'</span><span class="token punctuation">)</span>
 <span class="token number">12</span>   <span class="token punctuation">}</span>
 <span class="token number">13</span>   executors <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">14</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token number">15</span>       <span class="token string">'processpool'</span><span class="token punctuation">:</span> ProcessPoolExecutor（<span class="token number">5</span>）
 <span class="token number">16</span>   <span class="token punctuation">}</span>
 <span class="token number">17</span>   job_defaults <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">18</span>       <span class="token string">'coalesce'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token number">19</span>       <span class="token string">'max_instances'</span><span class="token punctuation">:</span> <span class="token number">3</span>
 <span class="token number">20</span>   <span class="token punctuation">}</span>
 <span class="token number">21</span> scheduler <span class="token operator">=</span> BackgroundScheduler<span class="token punctuation">(</span>jobstores<span class="token operator">=</span>jobstores<span class="token punctuation">,</span> executors<span class="token operator">=</span>executors<span class="token punctuation">,</span>    job_defaults<span class="token operator">=</span>job_defaults<span class="token punctuation">,</span> timezone<span class="token operator">=</span>utc<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre>
<h4><a id="_166" target="_blank"></a>方法二</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)"><span class="token number">1</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>background <span class="token keyword">import</span> BackgroundScheduler
  <span class="token number">2</span>   scheduler <span class="token operator">=</span> BackgroundScheduler<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token number">3</span>       <span class="token string">'apscheduler.jobstores.mongo'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token number">4</span>            <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'mongodb'</span>
  <span class="token number">5</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span>       <span class="token string">'apscheduler.jobstores.default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token number">7</span>           <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'sqlalchemy'</span><span class="token punctuation">,</span>
  <span class="token number">8</span>           <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'sqlite:///jobs.sqlite'</span>
  <span class="token number">9</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token number">10</span>       <span class="token string">'apscheduler.executors.default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
 <span class="token number">11</span>           <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'apscheduler.executors.pool:ThreadPoolExecutor'</span><span class="token punctuation">,</span>
 <span class="token number">12</span>           <span class="token string">'max_workers'</span><span class="token punctuation">:</span> <span class="token string">'20'</span>
 <span class="token number">13</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token number">14</span>       <span class="token string">'apscheduler.executors.processpool'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
 <span class="token number">15</span>           <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'processpool'</span><span class="token punctuation">,</span>
 <span class="token number">16</span>           <span class="token string">'max_workers'</span><span class="token punctuation">:</span> <span class="token string">'5'</span>
 <span class="token number">17</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token number">18</span>       <span class="token string">'apscheduler.job_defaults.coalesce'</span><span class="token punctuation">:</span> <span class="token string">'false'</span><span class="token punctuation">,</span>
 <span class="token number">19</span>       <span class="token string">'apscheduler.job_defaults.max_instances'</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
 <span class="token number">20</span>       <span class="token string">'apscheduler.timezone'</span><span class="token punctuation">:</span> <span class="token string">'UTC'</span><span class="token punctuation">,</span>
 <span class="token number">21</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span>

<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre>
<h4><a id="_191" target="_blank"></a>方法三：</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token keyword">from</span> pytz <span class="token keyword">import</span> utc
  <span class="token number">2</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>background <span class="token keyword">import</span> BackgroundScheduler
  <span class="token number">3</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>sqlalchemy <span class="token keyword">import</span> SQLAlchemyJobStore
  <span class="token number">4</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>executors<span class="token punctuation">.</span>pool <span class="token keyword">import</span> ProcessPoolExecutor
  <span class="token number">5</span>
  <span class="token number">6</span>   jobstores <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">7</span>       <span class="token string">'mongo'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'mongodb'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> SQLAlchemyJobStore<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'sqlite:///jobs.sqlite'</span><span class="token punctuation">)</span>
  <span class="token number">9</span>   <span class="token punctuation">}</span>
 <span class="token number">10</span>   executors <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">11</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'threadpool'</span><span class="token punctuation">,</span> <span class="token string">'max_workers'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token number">12</span>       <span class="token string">'processpool'</span><span class="token punctuation">:</span> ProcessPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
 <span class="token number">13</span>   <span class="token punctuation">}</span>
 <span class="token number">14</span>   job_defaults <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">15</span>       <span class="token string">'coalesce'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token number">16</span>       <span class="token string">'max_instances'</span><span class="token punctuation">:</span> <span class="token number">3</span>
 <span class="token number">17</span>   <span class="token punctuation">}</span>
 <span class="token number">18</span>   scheduler <span class="token operator">=</span> BackgroundScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">19</span>
 <span class="token number">20</span>   <span class="token comment"># .. do something else here, maybe add jobs etc.</span>
 <span class="token number">21</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre>
<p>以上涵盖了大多数情况的调度器配置，在实际运行时可以试试不同的配置会有怎样不同的效果。</p>
<h2><a name="t5"></a><a id="_217" target="_blank"></a>启动调度器</h2>
<p>启动调度器前需要先添加作业，有两种方法向调度器添加作业：一是通过接口add_job()，二是通过使用函数装饰器，其中 add_job() 返回一个apscheduler.job.Job类的实例，用于后续修改或删除作业。</p>
<p>我们可以随时在调度器上调度作业。如果在添加作业时，调度器还没有启动，那么任务将不会运行，并且第一次运行时间在调度器启动时计算。<br>
注意：如果使用的是序列化作业的执行器或作业存储器，那么要求被调用的作业（函数）必须是全局可访问的，被调用的作业的参数是可序列化的，作业存储器中，只有 MemoryJobStore 不会序列化作业。执行器中，只有ProcessPoolExecutor 将序列化作业。</p>
<p>启用调度器只需要调用调度器的 start() 方法，下面分别使用不同的作业存储器来举例说明：</p>
<h4><a id="_225" target="_blank"></a>方法一：使用默认的作业存储器：</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token comment">#coding:utf-8</span>
  <span class="token number">2</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler
  <span class="token number">3</span>   <span class="token keyword">import</span> datetime
  <span class="token number">4</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>memory <span class="token keyword">import</span> MemoryJobStore
  <span class="token number">5</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>executors<span class="token punctuation">.</span>pool <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> ProcessPoolExecutor
  <span class="token number">6</span>
  <span class="token number">7</span>   <span class="token keyword">def</span> <span class="token function">my_job</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'my_job'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token number">8</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span><span class="token string">'--&gt;'</span><span class="token punctuation">,</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token number">9</span>   jobstores <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">10</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> MemoryJobStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">11</span>
 <span class="token number">12</span>   <span class="token punctuation">}</span>
 <span class="token number">13</span>   executors <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">14</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token number">15</span>       <span class="token string">'processpool'</span><span class="token punctuation">:</span> ProcessPoolExecutor<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
 <span class="token number">16</span>   <span class="token punctuation">}</span>
 <span class="token number">17</span>   job_defaults <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">18</span>       <span class="token string">'coalesce'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token number">19</span>       <span class="token string">'max_instances'</span><span class="token punctuation">:</span> <span class="token number">3</span>
 <span class="token number">20</span>   <span class="token punctuation">}</span>
 <span class="token number">21</span>   scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span>jobstores<span class="token operator">=</span>jobstores<span class="token punctuation">,</span> executors<span class="token operator">=</span>executors<span class="token punctuation">,</span> job_defaults<span class="token operator">=</span>job_defaults<span class="token punctuation">)</span>
 <span class="token number">22</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_interval'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_interval'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'interval'</span><span class="token punctuation">,</span> seconds<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>replace_existing<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 <span class="token number">23</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_cron'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_cron'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'cron'</span><span class="token punctuation">,</span>month<span class="token operator">=</span><span class="token string">'4-8,11-12'</span><span class="token punctuation">,</span>hour<span class="token operator">=</span><span class="token string">'7-11'</span><span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token string">'*/10'</span><span class="token punctuation">,</span>\
 <span class="token number">24</span>                     end_date<span class="token operator">=</span><span class="token string">'2018-05-30'</span><span class="token punctuation">)</span>
 <span class="token number">25</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_once_now'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_once_now'</span><span class="token punctuation">)</span>
 <span class="token number">26</span>  scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_date_once'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_date_once'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'date'</span><span class="token punctuation">,</span>run_date<span class="token operator">=</span><span class="token string">'2018-04-05 07:48:05'</span><span class="token punctuation">)</span>
 <span class="token number">27</span>   <span class="token keyword">try</span><span class="token punctuation">:</span>
 <span class="token number">28</span>       scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">29</span>   <span class="token keyword">except</span> SystemExit<span class="token punctuation">:</span>
 <span class="token number">30</span>       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span>
 <span class="token number">31</span>       exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li></ul></pre>
<p>运行结果如下：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">job_once_now <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">00.967391</span>
job_date_once <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">05.005532</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">05.954023</span>
job_cron <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">10.004431</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">10.942542</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">15.952208</span>
job_cron <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20.007123</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20.952202</span>
……
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre>
<p>上述代码使用内存作为作业存储器，操作比较简单，重启程序相当于第一次运行。</p>
<h4><a id="_272" target="_blank"></a>方法二：使用数据库作为存储器：</h4>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token comment">#coding:utf-8</span>
  <span class="token number">2</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler
  <span class="token number">3</span>   <span class="token keyword">import</span> datetime
  <span class="token number">4</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>memory <span class="token keyword">import</span> MemoryJobStore
  <span class="token number">5</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>executors<span class="token punctuation">.</span>pool <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> ProcessPoolExecutor
  <span class="token number">6</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>jobstores<span class="token punctuation">.</span>sqlalchemy <span class="token keyword">import</span> SQLAlchemyJobStore
  <span class="token number">7</span>   <span class="token keyword">def</span> <span class="token function">my_job</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'my_job'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token number">8</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span><span class="token string">'--&gt;'</span><span class="token punctuation">,</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token number">9</span>   jobstores <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">10</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> SQLAlchemyJobStore<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'sqlite:///jobs.sqlite'</span><span class="token punctuation">)</span>
 <span class="token number">11</span>   <span class="token punctuation">}</span>
 <span class="token number">12</span>   executors <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">13</span>       <span class="token string">'default'</span><span class="token punctuation">:</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token number">14</span>       <span class="token string">'processpool'</span><span class="token punctuation">:</span> ProcessPoolExecutor<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
 <span class="token number">15</span>   <span class="token punctuation">}</span>
 <span class="token number">16</span>   job_defaults <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">17</span>       <span class="token string">'coalesce'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token number">18</span>       <span class="token string">'max_instances'</span><span class="token punctuation">:</span> <span class="token number">3</span>
 <span class="token number">19</span>   <span class="token punctuation">}</span>
 <span class="token number">20</span>  scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span>jobstores<span class="token operator">=</span>jobstores<span class="token punctuation">,</span> executors<span class="token operator">=</span>executors<span class="token punctuation">,</span> job_defaults<span class="token operator">=</span>job_defaults<span class="token punctuation">)</span>
 <span class="token number">21</span>  scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_interval'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_interval'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'interval'</span><span class="token punctuation">,</span> seconds<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>replace_existing<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 <span class="token number">22</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_cron'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_cron'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'cron'</span><span class="token punctuation">,</span>month<span class="token operator">=</span><span class="token string">'4-8,11-12'</span><span class="token punctuation">,</span>hour<span class="token operator">=</span><span class="token string">'7-11'</span><span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token string">'*/10'</span><span class="token punctuation">,</span>\
 <span class="token number">23</span>                     end_date<span class="token operator">=</span><span class="token string">'2018-05-30'</span><span class="token punctuation">)</span>
 <span class="token number">24</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_once_now'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_once_now'</span><span class="token punctuation">)</span>
 <span class="token number">25</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>my_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'job_date_once'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'job_date_once'</span><span class="token punctuation">,</span>trigger<span class="token operator">=</span><span class="token string">'date'</span><span class="token punctuation">,</span>run_date<span class="token operator">=</span><span class="token string">'2018-04-05 07:48:05'</span><span class="token punctuation">)</span>
 <span class="token number">26</span>   <span class="token keyword">try</span><span class="token punctuation">:</span>
 <span class="token number">27</span>       scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">28</span>   <span class="token keyword">except</span> SystemExit<span class="token punctuation">:</span>
 <span class="token number">29</span>       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span>
 <span class="token number">30</span>       exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li></ul></pre>
<p>说明，在第 6 行、第 10 行代码修改为数据库作为作业存储器<br>
运行结果如下：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">Run time of job <span class="token string">"my_job (trigger: date[2018-04-05 07:48:05 CST], next run at: 2018-04-05 07:48:05 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">28.898146</span>
job_once_now <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">34.010194</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">38.445843</span>
job_cron <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">40.154978</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">43.285941</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">48.334360</span>
job_cron <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">50.172968</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">53.281743</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">58.309952</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre>
<p>提示我们有作业本应在 2018-04-05 07:48:05 运行的作业没有运行，因为现在的时间为 2018-04-05 08:06:34，错过了 0:18:28 的时间。<br>
如果将上术代码第 21-25 行注释掉，重新运行本程序，则四种类型的作业仍会运行，结果如下：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">Run time of job <span class="token string">"my_job (trigger: cron[month='4-8,11-12', hour='7-11', second='*/10'], next run at: 2018-04-05 08:14:40 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">23.680603</span>
Run time of job <span class="token string">"my_job (trigger: cron[month='4-8,11-12', hour='7-11', second='*/10'], next run at: 2018-04-05 08:14:40 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">13.681604</span>
Run time of job <span class="token string">"my_job (trigger: cron[month='4-8,11-12', hour='7-11', second='*/10'], next run at: 2018-04-05 08:14:40 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">03.681604</span>
……
Run time of job <span class="token string">"my_job (trigger: interval[0:00:05], next run at: 2018-04-05 08:14:38 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">15.687917</span>
Run time of job <span class="token string">"my_job (trigger: interval[0:00:05], next run at: 2018-04-05 08:14:38 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">10.687917</span>
Run time of job <span class="token string">"my_job (trigger: interval[0:00:05], next run at: 2018-04-05 08:14:38 CST)"</span> was missed by <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05.687917</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">33.821645</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38.529167</span>
job_cron <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">40.150080</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">43.296188</span>
job_interval <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">48.327317</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre>
<p>作业仍会运行，说明作业被添加到数据库中，程序中断后重新运行时会自动从数据库读取作业信息，而不需要重新再添加到调度器中，如果不注释 21-25 行添加作业的代码，则作业会重新添加到数据库中，这样就有了两个同样的作业，避免出现这种情况可以在 add_job 的参数中增加 replace_existing=True，如</p>
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.signin(event)">scheduler.add_job(my_job, args=['job_interval',],id='job_interval',trigger='interval',seconds=3,replace_existing=True)
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<p>如果我们想运行错过运行的作业，使用 misfire_grace_time，如</p>
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.signin(event)">scheduler.add_job(my_job,args = ['job_cron',] ,id='job_cron',trigger='cron',month='4-8,11-12',hour='7-11',second='*/15',coalesce=True,misfire_grace_time=30,replace_existing=True,end_date='2018-05-30')
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<p>说明：misfire_grace_time，假如一个作业本来 08:00 有一次执行，但是由于某种原因没有被调度上，现在 08:01 了，这个 08:00 的运行实例被提交时，会检查它预订运行的时间和当下时间的差值（这里是1分钟），大于我们设置的 30 秒限制，那么这个运行实例不会被执行。最常见的情形是 scheduler 被 shutdown 后重启，某个任务会积攒了好几次没执行如 5 次，下次这个作业被提交给执行器时，执行 5 次。设置 coalesce=True 后，只会执行一次。<br>
其他操作如下：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   scheduler<span class="token punctuation">.</span>remove_job<span class="token punctuation">(</span>job_id<span class="token punctuation">,</span>jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment">#删除作业</span>
  <span class="token number">2</span>   scheduler<span class="token punctuation">.</span>remove_all_jobs<span class="token punctuation">(</span>jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment">#删除所有作业</span>
  <span class="token number">3</span>   scheduler<span class="token punctuation">.</span>pause_job<span class="token punctuation">(</span>job_id<span class="token punctuation">,</span>jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment">#暂停作业</span>
  <span class="token number">4</span>   scheduler<span class="token punctuation">.</span>resume_job<span class="token punctuation">(</span>job_id<span class="token punctuation">,</span>jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment">#恢复作业</span>
  <span class="token number">5</span>   scheduler<span class="token punctuation">.</span>modify_job<span class="token punctuation">(</span>job_id<span class="token punctuation">,</span> jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>changes<span class="token punctuation">)</span><span class="token comment">#修改单个作业属性信息</span>
  <span class="token number">6</span>   scheduler<span class="token punctuation">.</span>reschedule_job<span class="token punctuation">(</span>job_id<span class="token punctuation">,</span> jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> trigger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token operator">**</span>trigger_args<span class="token punctuation">)</span><span class="token comment">#修改单个作业的触发器并更新下次运行时间</span>
  <span class="token number">7</span>   scheduler<span class="token punctuation">.</span>print_jobs<span class="token punctuation">(</span>jobstore<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> out<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token comment">#输出作业信息</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre>
<h2><a name="t6"></a><a id="_357" target="_blank"></a>调度器事件监听</h2>
<p>scheduler 的基本应用，在前面已经介绍过了，但仔细思考一下：如果程序有异常抛出会影响整个调度任务吗？请看下面的代码，运行一下看看会发生什么情况：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token comment"># coding:utf-8</span>
  <span class="token number">2</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler
  <span class="token number">3</span>   <span class="token keyword">import</span> datetime
  <span class="token number">4</span>
  <span class="token number">5</span>   <span class="token keyword">def</span> <span class="token function">aps_test</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token number">6</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token number">7</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
  <span class="token number">8</span>
  <span class="token number">9</span>   scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">10</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>func<span class="token operator">=</span>aps_test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'定时任务'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trigger<span class="token operator">=</span><span class="token string">'cron'</span><span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token string">'*/5'</span><span class="token punctuation">)</span>
 <span class="token number">11</span>
 <span class="token number">12</span>   scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre>
<p>运行结果如下：</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">Job <span class="token string">"aps_test (trigger: cron[second='*/5'], next run at: 2018-04-05 12:46:35 CST)"</span> raised an exception
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Users\xx\AppData\Local\Programs\python\python36\lib\site-packages\apscheduler\executors\base.py"</span><span class="token punctuation">,</span> line <span class="token number">125</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run_job
    retval <span class="token operator">=</span> job<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>job<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>job<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span>
  File <span class="token string">"C:/Users/xx/PycharmProjects/mysite/staff/test2.py"</span><span class="token punctuation">,</span> line <span class="token number">7</span><span class="token punctuation">,</span> <span class="token keyword">in</span> aps_test
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero
Job <span class="token string">"aps_test (trigger: cron[second='*/5'], next run at: 2018-04-05 12:46:35 CST)"</span> raised an exception
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Users\xx\AppData\Local\Programs\python\python36\lib\site-packages\apscheduler\executors\base.py"</span><span class="token punctuation">,</span> line <span class="token number">125</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run_job
    retval <span class="token operator">=</span> job<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>job<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>job<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span>
  File <span class="token string">"C:/Users/xx/PycharmProjects/mysite/staff/test2.py"</span><span class="token punctuation">,</span> line <span class="token number">7</span><span class="token punctuation">,</span> <span class="token keyword">in</span> aps_test
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre>
<p>可能看出每 5 秒抛出一次报错信息。任何代码都可能抛出异常，关键是，发生导常事件，如何第一时间知道，这才是我们最关心的，apscheduler 已经为我们想到了这些，提供了事件监听来解决这一问题。<br>
将上述代码稍做调整，加入日志记录和事件监听，如下所示。</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)">  <span class="token number">1</span>   <span class="token comment"># coding:utf-8</span>
  <span class="token number">2</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>blocking <span class="token keyword">import</span> BlockingScheduler
  <span class="token number">3</span>   <span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>events <span class="token keyword">import</span> EVENT_JOB_EXECUTED<span class="token punctuation">,</span> EVENT_JOB_ERROR
  <span class="token number">4</span>   <span class="token keyword">import</span> datetime
  <span class="token number">5</span>   <span class="token keyword">import</span> logging
  <span class="token number">6</span>
  <span class="token number">7</span>   logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
  <span class="token number">8</span>                       <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span><span class="token punctuation">,</span>
  <span class="token number">9</span>                       datefmt<span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span>
 <span class="token number">10</span>                       filename<span class="token operator">=</span><span class="token string">'log1.txt'</span><span class="token punctuation">,</span>
 <span class="token number">11</span>                       filemode<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span>
 <span class="token number">12</span>
 <span class="token number">13</span>
 <span class="token number">14</span>   <span class="token keyword">def</span> <span class="token function">aps_test</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token number">15</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
 <span class="token number">16</span>
 <span class="token number">17</span>
 <span class="token number">18</span>   <span class="token keyword">def</span> <span class="token function">date_test</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token number">19</span>       <span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
 <span class="token number">20</span>       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">21</span>
 <span class="token number">22</span>
 <span class="token number">23</span>   <span class="token keyword">def</span> <span class="token function">my_listener</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token number">24</span>       <span class="token keyword">if</span> event<span class="token punctuation">.</span>exception<span class="token punctuation">:</span>
 <span class="token number">25</span>           <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'任务出错了！！！！！！'</span><span class="token punctuation">)</span>
 <span class="token number">26</span>       <span class="token keyword">else</span><span class="token punctuation">:</span>
 <span class="token number">27</span>           <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'任务照常运行...'</span><span class="token punctuation">)</span>
 <span class="token number">28</span>
 <span class="token number">29</span>   scheduler <span class="token operator">=</span> BlockingScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">30</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>func<span class="token operator">=</span>date_test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'一次性任务,会出错'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next_run_time<span class="token operator">=</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'date_task'</span><span class="token punctuation">)</span>
 <span class="token number">31</span>   scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>func<span class="token operator">=</span>aps_test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'循环任务'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trigger<span class="token operator">=</span><span class="token string">'interval'</span><span class="token punctuation">,</span> seconds<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'interval_task'</span><span class="token punctuation">)</span>
 <span class="token number">32</span>   scheduler<span class="token punctuation">.</span>add_listener<span class="token punctuation">(</span>my_listener<span class="token punctuation">,</span> EVENT_JOB_EXECUTED <span class="token operator">|</span> EVENT_JOB_ERROR<span class="token punctuation">)</span>
 <span class="token number">33</span>   scheduler<span class="token punctuation">.</span>_logger <span class="token operator">=</span> logging
 <span class="token number">34</span>
 <span class="token number">35</span>   scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre>
<p>说明：<br>
第 7-11 行配置日志记录信息，日志文件在当前路径，文件名为 “log1.txt”。<br>
第 33 行启用 scheduler 模块的日记记录。<br>
第 23-27 定义一个事件监听，出现意外情况打印相关信息报警。<br>
运行结果如下所示。</p>
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.signin(event)"><span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">29</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">32</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">35</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">38</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">41</span> 一次性任务<span class="token punctuation">,</span>会出错
任务出错了！！！！！！
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">41</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">44</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">47</span> 循环任务
任务照常运行<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre>
<p>在生产环境中，可以把出错信息换成发送一封邮件或者发送一个短信，这样定时任务出错就可以立马就知道。</p>


          </div>
          <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet">
                  </div>
  </article>
</body>
</html>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">文章目录</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">基本概念介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">调度器的工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">实例1 -间隔性任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">实例2 - cron 任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">配置调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">方法二</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.3.</span> <span class="toc-text">方法三：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">启动调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.1.</span> <span class="toc-text">方法一：使用默认的作业存储器：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">0.2.</span> <span class="toc-text">方法二：使用数据库作为存储器：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number"></span> <span class="toc-text">调度器事件监听</span></a>
    </li></div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&text=apscheduler"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&is_video=false&description=apscheduler"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=apscheduler&body=Check out this article: http://logan_2019.github.io/csdn/python_apscheduler/2019/10/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&title=apscheduler"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://logan_2019.github.io/csdn/python_apscheduler/2019/10/&name=apscheduler&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Logan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
