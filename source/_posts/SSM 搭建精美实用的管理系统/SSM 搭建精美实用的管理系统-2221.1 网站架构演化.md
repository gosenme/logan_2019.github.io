---
title: SSM 搭建精美实用的管理系统-22
---
<article id="topicContainer" class="column_content"><h2 class="topic_title"></h2><div><h3 id="211">21.1 网站架构演化</h3>
<p>大部分开发者可能对网站架构的概念及演化过程不甚了解。他们在日常的开发工作中，往往只负责整个系统的部分模块，了解到的也仅仅是整个架构中的一小部分，很难从全局掌握系统的完整架构以及演进过程。本文致力于带大家从更宏观的角度，从整体到细节全面认识网站架构的演化过程。</p>
<h4 id="1">1. 初始阶段</h4>
<p>项目初期，网站系统需快速开发并及时上线。通常，这个时候用户规模并不大，公司投入的经济、资源也非常有限，系统部署时应用程序、数据库、文件等所有资源往往集中在一台服务器上。</p>
<p>初始阶段，网站架构往往比较简单，一台服务器就可以搞定。我们所开发的 ssm-demo 项目即是如此，这是网站架构演进过程中最基础也是每个开发人员都会经历的阶段。</p>
<p><img src="https://images.gitbook.cn/2a5a4f30-b5c0-11e8-b571-d9b5354f1ca8" alt="1" /></p>
<h4 id="2">2. 数据服务与应用分离</h4>
<p>随着业务发展，将所有应用和模块部署在同一台机器的做法，终将会给系统带来性能瓶颈。网络带宽和服务器资源渐渐吃紧，此时的单机部署已不再适应业务的发展，需要将应用和数据分别部署在三台服务器上，即应用服务器、文件服务器与数据库服务器。分离后的三台服务器对硬件资源的需求各不相同：应用服务器需要更快更强大的 CPU，而数据库服务器需要更快的硬盘和更大的内存，文件服务器则需要更大的硬盘。</p>
<p><img src="https://images.gitbook.cn/43f9c1f0-b5c0-11e8-b571-d9b5354f1ca8" alt="2" /></p>
<h4 id="3">3. 缓存</h4>
<p>之后，随着访问量渐渐增长，数据库压力与日俱增，这时需要做的就是减少数据库访问压力，提高网站的数据访问速度。正如第 20 课《 项目优化之缓存整合 》中提到的方案，缓存层的接入，可分担数据库的直接压力，提升网站的响应性能。</p>
<p><img src="https://images.gitbook.cn/4e5ee3f0-b5c0-11e8-a6d8-3f4d0cc249cc" alt="3" /></p>
<h4 id="4">4. 集群</h4>
<p>来自数据和文件访问的压力暂时缓解后，随着系统的继续演进，访问量的继续增大，Web 服务器（使用 Java 语言开发的系统通常使用 Tomcat 服务器）也将出现瓶颈，业界较常用的解决方案仍是 “ 堆机器 ”，也就是所谓的集群部署。单一应用服务器能够处理的请求连接有限，在网站访问高峰时期，应用服务器会成为整个网站的瓶颈，这时选用负载均衡处理器势在必然。负载均衡处理器可以把来自浏览器的访问请求分发到应用集群中的任何一台服务器上，从而将压力分发出去。</p>
<p><img src="https://images.gitbook.cn/5aa76bf0-b5c0-11e8-b3b2-8f3a5efca007" alt="4" /></p>
<h4 id="5">5. 动静分离</h4>
<p>为了提高网站的响应速度，减轻 Web 服务器（Tomcat）的负载，我们可以将静态资源（比如图片、JavaScript 、CSS 等文件）请求和用户动态请求拆分开来，当浏览器请求某个静态资源时，代理服务器可直接处理，而不用将请求转发给后端服务器。拆分动态资源和静态资源请求，并做分流，这就是动静分离。动静分离是提高网站响应速度的常用方式之一，将动态请求与静态请求分离开，尽量减少对应用服务器的压力。再进一步，还可以对静态请求进行缓存，以加快响应速度。</p>
<p><img src="https://images.gitbook.cn/645572f0-b5c0-11e8-b3b2-8f3a5efca007" alt="5" /></p>
<p>前面几篇文章中，我们所介绍的优化方案，重点在于项目代码本身的优化，更多是对项目代码和基础性能的优化，未涉及更复杂的架构知识。接下来的内容，将重点讲解系统部署优化方法及实现过程，比如上面提到的集群和动静分离方案的实现，技术选用的是 Nginx 。</p>
<p>此外，后面两篇文章将讲解如何利用 Nginx+Tomcat 实现负载均衡的集群系统，以及如何利用 Nginx+Tomcat 实现动静分离。</p>
<h3 id="212nginx">21.2 Nginx</h3>
<p><img src="https://images.gitbook.cn/83e21420-b5c0-11e8-a6d8-3f4d0cc249cc" alt="nginx" /></p>
<p>Nginx 是一款轻量级的 Web 服务器、反向代理服务器，由于其占用内存少，启动极快，高并发能力强，在互联网项目中得到广泛应用，国内使用 Nginx 的网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。</p>
<p>Nginx 主要有以下几个特点：</p>
<ul>
<li>跨平台。</li>
</ul>
<p>Nginx 可以在 Windows 、Linux 等系统上安装使用，且能在大部分系统上编译运行。此外，还可根据不同操作系统的特点采用不同的事件模型，从而充分发挥系统本身的特性。 </p>
<ul>
<li>轻量级、扩展性好。</li>
</ul>
<p>Nginx 由 C 语言开发，源代码中只包含了核心代码，其他功能通过插件形式来扩展，代码的模块化设计也方便开发者根据自身业务进行定制化修改。 </p>
<ul>
<li>支持高并发、内存消耗低。</li>
</ul>
<p>基于磁盘的异步 IO，通信机制采用 epoll 模型，内存池、事件池等细节优化 …… 这些使得 Nginx 占用更少系统资源、支持更大的并发连接。官方称单节点可支持 5 万并发连接数，在实际生产环境中能够承受 2~3 万并发压力，对于大部分网站来说已经足够了。 </p>
<ul>
<li>学习成本低。</li>
</ul>
<p>Nginx 开源免费，且安装、配置简单，可以快速学习并上手使用，测试起来也很方便，可以很方便地应用到生产环境中。 </p>
<h3 id="213nginx">21.3 Nginx 可以做什么</h3>
<p>在大家的认知中，Nginx 是一个负载均衡器，负责请求的转发和集群的实现。除了负载均衡器，它另外还有一些十分重要的功能特点，接下来会详细介绍。</p>
<h4 id="1-1">1. 反向代理</h4>
<blockquote>
  <p>代理服务器接受 Internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将服务器返回的结果发送给 Internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p>
  <p>简单地说，就是真实的服务器不能直接被外部网络访问，这时需要一台代理服务器，而代理服务器能被外部网络访问且又与真实服务器同在一个网络环境中，当然也可能是同一台服务器，端口不同而已。</p>
</blockquote>
<p>在 Tomcat 服务器上部署多个实例时，经常用到这个功能。举个简单的例子，公司有三个不同的 Web 项目需部署在一台 Linux 机器上，三个项目的访问地址分别为： http://a.csdn.com 、 http://b.csdn.com 和 http://c.csdn.com 。如果该机器上只部署一个 Tomcat 服务器（监听 80 端口）时，三个项目可部署在其 webapps 目录下，相应设置后，在原有地址上加上对应的虚拟目录即可访问相应的项目。这种情况下，一旦 Tomcat 挂掉，其上的所有项目都将无法访问。使用 Nginx 反向代理可将三个项目的 War 包部署在三个不同的 Tomcat 中，即使一台 Tomcat 容器出现问题也不会影响另外两个项目的正常访问。在只有一台 Tomcat 服务器的情况下，使用 Nginx 反向代理+Tomcat 的组合将是个不错的选择。</p>
<p>Nginx+Tomcat 反向代理的示例图如下：</p>
<p><img src="https://images.gitbook.cn/a0302c20-b5c0-11e8-b3b2-8f3a5efca007" alt="nginx-proxy1" /></p>
<h4 id="2-1">2. 负载均衡</h4>
<p>系统压力越来越大，单机 Tomcat 已经不足以支撑这种压力时，通常选用的优化方案是增加 Tomcat 服务器，即把应用服务器从一台变成了两台甚至多台，把用户的请求分散到不同服务器中，从而缓解单机瓶颈带来的隐患，提高系统的负载能力，Nginx+多 Tomcat 实例的集群方案就是一个不错的选择。</p>
<p>结合讲解反向代理时的举例，我们来看看反向代理和集群方案的不同。在反向代理中，三台 Tomcat 服务器中部署的是三个不同的项目且访问域名不同，而这里的集群方案，多台 Tomcat 服务器中部署的是同一个项目，多台 Tomcat 组成集群共同对外服务，此时的 Nginx 作为负载均衡调度器对请求进行分配，希望大家能够区分二者间的区别。</p>
<p>Nginx+Tomcat 集群示例图如下：</p>
<p><img src="https://images.gitbook.cn/ade403f0-b5c0-11e8-b620-f5e17eb8ec57" alt="nginx-tomcat-cluster" /></p>
<h4 id="3http">3. HTTP 服务器</h4>
<p>Nginx 本身也是一个静态资源服务器，当只有静态资源时，可以将 Nginx 作为服务器。同时，现在很流行的动静分离，也可以通过 Nginx 来实现。</p>
<h4 id="4-1">4. 正向代理</h4>
<p>正向代理与反向代理是相对的，反向代理是替代服务器接受客户端的请求，而正向代理是替代客户端发起请求。我们可以结合 VPN 来理解正向代理的概念。当某一资源无法访问，而另外一台机器 P1 可以访问时，我们可通过某种设置将 P1 当作跳板机，来访问该资源。这个跳板机就是我们的代理服务器，此时的代理即为正向代理。</p>
<p>而反向代理则不同，它替代真正的 Web 服务器（比如 Tomcat）接受客户端的请求，而客户端接触不到真正的服务器，也无法知晓所请求的究竟是 Tomcat 还是 JBoss，也不知道服务器有一台还是多台，这就是反向代理。</p>
<p>二者的区别，请看下面的示例图：</p>
<p><img src="https://images.gitbook.cn/ba3390d0-b5c0-11e8-b3b2-8f3a5efca007" alt="nginx-proxy2" /></p>
<h4 id="5-1">5. 动静分离</h4>
<p>Nginx 既可以作为 HTTP 服务器处理静态资源，也可以作为反向代理工具，将请求转发至 Tomcat 进行处理，因此我们可以利用 Nginx+Tomcat 实现用户请求的动静分离，进一步减轻 Tomcat 服务器的负载压力，且 Nginx 在处理静态资源文件上性能更优秀，这个组合可以使它们各司其职，发挥各自的优势，进一步提升系统的整体性能。</p>
<p><img src="https://images.gitbook.cn/d58f0b70-b5c0-11e8-b571-d9b5354f1ca8" alt="dynamic-resource" /></p>
<h3 id="214">21.4 总结</h3>
<p>本文简单介绍了系统部署优化过程，并详细介绍了 Nginx 方案以及 Nginx 的优点和作用。选择 Nginx 是因为它功能强大且功能点丰富，基本可以满足网站架构进一步优化的要求。后续章节我们会继续介绍
 Nginx 常用的优化方案，帮助大家更好掌握这些技能。</p></div></article>