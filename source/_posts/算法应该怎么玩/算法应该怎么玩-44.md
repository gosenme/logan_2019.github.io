---
title: 算法应该怎么玩-44
---
<article id="topicContainer" class="column_content"><h2 class="topic_title"></h2><div><blockquote>
  <p>相似度算法是计算个体之间相似程度的算法，此类算法多如牛毛，这里我们只讨论用于处理文字之间相似度的算法。文本之间的相似度计算应用广泛，比如论文抄袭的判断，就可以用相似度算法先预筛查一遍；再比如网站的文章自动分类，就是根据相似度将文章自动分入科技、体育、军事等类别中。此外，广告推送、订单识别等场合，也会用到文本相似度的判断。</p>
</blockquote>
<h3 id="">余弦相似度（余弦距离）</h3>
<p>通常用于判断相似度的理论有很多，比如欧氏距离、余弦相似度（余弦距离）、Jaccard 距离、编辑距离等，余弦相似度背后的数学理论就是余弦定理。</p>
<h4 id="-1">余弦定理</h4>
<p><img src="https://images.gitbook.cn/983739b0-0fc9-11e9-97a1-b5c0cb989076"  width = "40%" /></p>
<p>图（1）三角形余弦公式</p>
<p>在（欧氏）几何学中，三角形的内角余弦与边长的关系，可以用余弦公式来描述，即：</p>
<p><img src="https://images.gitbook.cn/Fi6_TRMJZj_co72i4zyLtm3Zy1hL" alt="avatar" /></p>
<p>在空间向量中（图示以平面向量为例子），两个向量的夹角也可以通过：</p>
<p><img src="https://images.gitbook.cn/a6bfedb0-0fc9-11e9-b42e-390d5c3452ad"  width = "40%" /></p>
<p>图（2）平面向量余弦公式示意图</p>
<p>在空间向量中，对于任意两个 n 维空间向量 $\vec{a}=(x<em>{1},x</em>{2},...,x<em>{n})$ 和 $\vec{b}=(y</em>{1},y<em>{2},...,y</em>{n})$，这两个向量的夹角余弦也可以通过向量的余弦公式来计算：</p>
<p>$$
\begin{align<em>}
cos(\theta ) &= \frac{a\cdot b}{\left \| a \right \|\times \left \| b \right \|}\
 \
&=\frac{\sum<em>{i=1}^{n}(x</em>{i} \times y<em>{i})}{\sqrt{\sum</em>{i=1}^{n}(x<em>{i}^{2})} \times \sqrt{\sum</em>{i=1}^{n}(y_{i}^{2})}}
\end{align</em>}
$$</p>
<p>对于图（2）所示的平面向量来说，这个公式可以简化成：</p>
<p><img src="https://images.gitbook.cn/FhIaIjtt82n741zvWsp54DoYWeSD" alt="avatar" /></p>
<p>余弦定理的意义是什么呢？两个向量的夹角越接近 0 度，说明两个向量越相似，这就是由余弦定理推及的余弦相似性。</p>
<h4 id="-2">余弦相似度</h4>
<p>余弦相似度利用向量空间中两个向量的夹角余弦值来衡量两个文本间的相似程度，余弦值越接近 1，说明两个向量的夹角越接近 0 度，这两个向量就越相似。由于余弦相似性关注的是两个向量在方向上的差异，因而余弦相似性比较适用于近似的分类，不太适用于计算多个文本的相似程度绝对值。</p>
<h3 id="-3">相似性判断</h3>
<p>判断两个文本的相似度，首先要将两个文本转化成向量，然后才能参与计算，将两个文本转化成向量的方法有很多，基本上都是基于单词频度统计进行向量化。单词频度统计，首先要有单词表，在某些资料里，也将单词表称为“字典”。生成单词表，一种方法是对两段文本进行单词统计（如果是中文，则很不幸，因为还要进行分词处理），将所有出现的词列入单词表或字典中；另一种方法是根据文本内容的领域技术特点，预先整理出一个技术词典，这个技术词典包含了该技术领域内的典型词汇及每个词汇的权重，简单应用的场合，可以认为每个词汇的权重相等（都是 1）。</p>
<p>接下来将介绍如何用余弦相似度理论判断三句话的相似度，这三句话中的两句是军事领域中对榴弹炮的描述，另一句与军事无关。因为都是对火炮的描述，我们采用第二种向量化方法，预先整理了一个火炮相关的词典，原因就是简单。</p>
<h4 id="-4">将文本转化成向量</h4>
<p>我们先整理出一个关于榴弹炮的词典，为简单起见，词典中每个词的权重都相等，这个词汇表包含 11 个词，分别是：进攻、炮弹、射程、榴弹炮、发射、口径、迫击炮、瞄准、后坐力、弹道和目标，每个词的位置是固定的，这决定了向量中每个分量的位置。因为词典一共 11 个词，所以文本转化后的向量维度是 11 维。</p>
<p>假设这三句话分别是：</p>
<ul>
<li>口径为155 毫米的榴弹炮，炮弹的射程超过 40 公里，炮弹发射后击中目标的弹道是一条抛物线；</li>
<li>大口径榴弹炮射程很远且弹道弯曲，炮弹通常都不是直接对着目标瞄准，而是计算好抛物线弹道，以一定的仰角和方向发射炮弹；</li>
<li>我们必须统一口径，抵挡敌人发射的糖衣炮弹的进攻。</li>
</ul>
<p>对于第 1 句话，“进攻”出现 0 次，“炮弹”出现 2 次，“射程”出现 1 次……，统计完成后，得到一个 11 维向量：</p>
<p>{ 0,2,1,1,1,1,0,0,0,1,1 }</p>
<p>同样对于第 2 句话，可以得到另一个向量：</p>
<p>{ 0,2,1,1,1,1,0,1,0,2,1 }</p>
<p>对于第 3 句话，也得到一个向量：</p>
<p>{ 1,1,0,0,1,1,0,0,0,0,0 }</p>
<p>接下来，我们就用余弦公式计算这三个向量之间的相似度。</p>
<h4 id="-5">计算余弦值算法</h4>
<p>计算两个向量的余弦值算法实现就是对余弦公式的翻译，没有什么需要特别讲解的，看代码就好了：</p>
<pre><code class="c++ language-c++">double CosSimilarity(double *va, double *vb, int vn)
{
    double cossu = 0.0;
    double cossda = 0.0;
    double cossdb = 0.0;

    for (int i = 0; i &lt; vn; i++)
    {
        cossu += va[i] * vb[i];
        cossda += va[i] * va[i];
        cossdb += vb[i] * vb[i];
    }

    return cossu / (std::sqrt(cossda) * std::sqrt(cossdb));
}
</code></pre>
<p>经过计算，第 1 句话和第 2 句话的相似度是 0.9297，第 1 句话和第 3 句话的相似度是 0.6325，第 2 句话和第 3 句话的相似度是 0.5345，读者可以先自己体会。</p>
<h3 id="-6">总结</h3>
<p>利用余弦相似性计算文本相似度的处理流程是：</p>
<ul>
<li>确定词汇表，可以从两篇文章中整理关键词汇，合并成一个词汇合集，也可以采用技术领域的统一词汇表；</li>
<li>对每篇文章进行词频统计，生成各自的词频向量；</li>
<li>计算两个向量的余弦相似度，值越大（越接近 1）就表示越相似。</li>
</ul>
<p><a href="https://github.com/inte2000/play_with_algo">请单击这里下载源码</a></p>
<h3 id="-7">答疑与交流</h3>
<blockquote>
  <p><strong>为了方便与作者交流与学习，GitChat 编辑团队组织了一个《算法应该怎么玩》读者交流群，添加小助手-伽利略微信：「GitChatty6」，回复关键字「259」给小助手-伽利略获取入群资格。</strong></p>
</blockquote></div></article>